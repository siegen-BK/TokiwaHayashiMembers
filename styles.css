:root{
  --ink:#222;
  --grid:#222;          /* 罫線色（Excel風） */
  --bg:#fff;
  --muted:#666;

  /* 列幅（先頭行/追加行で共通） */
  --col-section: 1.6fr; /* 区間・場所 */
  --col-part:    0.92fr;/* 大胴〜笛（均等） */
  --col-notes:   1.4fr; /* 備考 */

  /* 行の高さ（2段構成の基準） */
  --h-unit: 36px;       /* 1段の高さ */
}

*{ box-sizing:border-box; }

body{
  font-family: system-ui, -apple-system, "Segoe UI", Roboto, Helvetica, Arial;
  margin:0;
  color:var(--ink);
  background:var(--bg);
}

/* 上部（タブ） */
.app-header{
  border-bottom:1px solid #eee;
  padding:12px 16px;
}
.tabs{
  display:flex;
  gap:8px;
  align-items:center;
  margin-top:8px;
  flex-wrap:wrap;
}
.tab{
  padding:6px 10px;
  border:1px solid #ddd;
  border-radius:8px;
  text-decoration:none;
  color:#222;
}
.tab.active{
  background:#0a7cff;
  color:#fff;
  border-color:#0a7cff;
}
.print{ margin-left:auto; }

main{
  padding:16px;
  max-width:960px;
  margin:0 auto;
}

.note{ color:var(--muted); }

/* 見出し行（＋追加 / タイトル） */
.section-header{
  display:flex;
  align-items:center;
  gap:8px;
  margin:12px 0;
}
.section-header h2{
  margin:0;
  font-size:28px;
  font-weight:700;
}

/* 追加ボタン */
.btn-add{
  padding:6px 10px;
  border:1px solid #0a7cff;
  background:#eaf2ff;
  color:#0a7cff;
  border-radius:8px;
  cursor:pointer;
}
.btn-add:hover{ background:#dbe9ff; }

/* =========================
   Excel風：外枠＋格子
   ========================= */

/* 列定義（ヘッダ/行で共通） */
.first-row-table,
.row-group{
  grid-template-columns:
    var(--col-section)
    var(--col-part) var(--col-part) var(--col-part)
    var(--col-part) var(--col-part)
    var(--col-notes);
}

/* ---- ヘッダ（先頭行） ----
   外枠：上・左・右（行群と同条件）
   下線はセル側（格子）に任せる
*/
.first-row-table{
  display:grid;
  border-top:1px solid var(--grid);
  border-left:1px solid var(--grid);
  border-right:1px solid var(--grid);
  border-bottom:none;
  margin:8px 0 0;
  column-gap:0;
  row-gap:0;
}

/* ヘッダセル：全セルに下線、縦線は「最後以外のセル」にだけ */
.first-row-table .cell{
  border-bottom:1px solid var(--grid);
  padding:10px 12px;
  text-align:center;
  font-size:15px;
  background:var(--bg);
  white-space:nowrap;
}
.first-row-table .cell:not(:last-child){
  border-right:1px solid var(--grid);
}

/* ---- 行群（追加行のまとまり） ----
   外枠：左・右のみ
   最下端の線は「最後の行の下線」に任せる
*/
.rows{
  border-left:1px solid var(--grid);
  border-right:1px solid var(--grid);
  margin-top:0;
  /* 横幅の揺れ対策が必要なら有効化 */
  /* overflow-x:hidden; */
}

/* ---- 追加行（1行＝2段グリッド） ----
   横格子：row-group の border-bottom
   縦格子：cell の border-right（最後のみ除外）
*/
.row-group{
  display:grid;
  grid-template-rows: 1fr 1fr;      /* 2段 */
  border-bottom:1px solid var(--grid);
  position:relative;               /* 余白ボタン(削除/結合)の絶対配置基準 */
  column-gap:0;
  row-gap:0;
}

/* セル共通（※行内の .ln を使うため1回に統合） */
.row-group .cell{
  border-right:1px solid var(--grid);
  padding:10px 12px;
  font-size:15px;
  background:var(--bg);

  /* 行(.ln)を縦に積む */
  display:flex;
  flex-direction:column;
  align-items:stretch;     /* .ln を幅いっぱいに */
  justify-content:center;  /* 縦方向の中央寄せ（不要なら normal） */

  min-height:var(--h-unit);
}

/* 右端セル（備考）の右線は外枠に任せる → 二重防止 */
.row-group .cell:last-of-type{
  border-right:none;
}

/* 2段ぶち抜き（大胴・中胴・側胴・備考） */
.row-group .span2{
  grid-row: 1 / span 2;
  min-height: calc(var(--h-unit) * 2);
}

/* 鉦・笛だけ下段に横線（2段の仕切り） */
.cell.split-top{
  border-top:1px solid var(--grid);
}

/* =========================
   区間 2段結合/解除（merge-section）
   ========================= */
/* 結合時：Top を2段ぶち抜き、Bottom を隠す */
.row-group.merge-section [data-field="sectionTop"]{
  grid-row: 1 / span 2;
  min-height: calc(var(--h-unit) * 2);
}
.row-group.merge-section [data-field="sectionBottom"]{
  display:none;
}

/* =========================
   行内テキストの行単位制御（.ln）
   ========================= */
/* セル内の行（1行＝1ブロック） */
.cell .ln{
  display:block;
  width:100%;
}

/* 行ごとの水平揃え（line 単位） */
.ln.align-left  { text-align:left; }
.ln.align-center{ text-align:center; }
.ln.align-right { text-align:right; }

/* 選択中行の視覚強調（任意） */
.ln.is-selected{
  outline:2px solid #0a7cff;
  outline-offset:-2px;
}

/* 右下の文字揃えツールバー（選択時だけ表示） */
.align-toolbar{
  position:fixed;
  right:14px;
  bottom:14px;
  z-index:9999;
  display:flex;
  gap:8px;
  background:#fff;
  border:1px solid #ddd;
  border-radius:10px;
  padding:8px;
  box-shadow:0 6px 18px rgba(0,0,0,.12);
}
.align-toolbar.hidden{ display:none; }
.align-toolbar button{
  padding:6px 10px;
  border:1px solid #ccc;
  background:#f8f8f8;
  border-radius:8px;
  cursor:pointer;
}
.align-toolbar button:hover{ background:#eee; }

/* =========================
   余白ボタン（削除＝右 / 結合＝左）
   ========================= */
.row-del{
  position:absolute;
  top:6px;
  right:-44px;
  width:34px; height:34px;
  border:1px solid #cfcfcf;
  border-radius:8px;
  background:#fff;
  cursor:pointer;
  display:grid; place-items:center;
  font-size:16px; line-height:1;
  z-index:10;
}
.row-del:hover{
  background:#ffecec;
  border-color:#ff6b6b;
}

/* 区間 2段結合/解除トグル（左側） */
.row-merge{
  position:absolute;
  top:6px;
  left:-44px;
  width:34px; height:34px;
  border:1px solid #cfcfcf;
  border-radius:8px;
  background:#fff;
  cursor:pointer;
  display:grid; place-items:center;
  font-size:16px; line-height:1;
  z-index:10;
}
.row-merge:hover{
  background:#eef7ff;
  border-color:#0a7cff;
}

/* 画面が狭いときは余白→内側へ */
@media (max-width: 520px){
  .row-del{ right:6px; }
  .row-merge{ left:6px; }
}

/* 印刷時（任意：線を濃く） */
@media print{
  :root{ --grid:#000; }
  .app-header{ display:none; }
  main{ max-width:none; margin:0; padding:0 18mm; }
}
